@page "/clubs/{ClubId:guid}"
@using MudBlazor
@using SmashScheduler.Application.Services.ClubManagement
@using SmashScheduler.Domain.Entities
@using SmashScheduler.Web.Components
@inject IClubService ClubService
@inject IDialogService DialogService
@inject NavigationManager Navigation

<PageTitle>Club Details</PageTitle>

@if (_club == null)
{
    <MudStack AlignItems="AlignItems.Center" Class="py-8">
        <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
    </MudStack>
}
else
{
    <MudStack Spacing="4">
        <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                <MudIconButton Icon="@Icons.Material.Filled.ArrowBack"
                               Color="Color.Default"
                               OnClick="GoBack" />
                <MudStack>
                    <MudText Typo="Typo.h4" Style="font-weight: 700;">@_club.Name</MudText>
                    <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
                        <MudChip T="string" Size="Size.Small" Variant="Variant.Filled" Color="Color.Primary">
                            @_club.DefaultCourtCount courts
                        </MudChip>
                        <MudChip T="string" Size="Size.Small" Variant="Variant.Filled" Color="Color.Secondary">
                            @_club.GameType
                        </MudChip>
                    </MudStack>
                </MudStack>
            </MudStack>
            <MudIconButton Icon="@Icons.Material.Filled.Edit"
                           Color="Color.Primary"
                           Variant="Variant.Filled"
                           Size="Size.Medium"
                           OnClick="OpenEditDialog" />
        </MudStack>

        <MudGrid Spacing="3">
            <MudItem xs="12" sm="6">
                <MudCard Class="smash-card smash-card-clickable" Elevation="2" @onclick="ViewPlayers">
                    <MudCardContent>
                        <MudStack Row="true" Spacing="3" AlignItems="AlignItems.Center">
                            <MudAvatar Size="Size.Large" Color="Color.Primary" Variant="Variant.Filled">
                                <MudIcon Icon="@Icons.Material.Filled.Groups" />
                            </MudAvatar>
                            <MudStack Spacing="0">
                                <MudText Typo="Typo.h6" Style="font-weight: 600;">Players</MudText>
                                <MudText Typo="Typo.body2" Color="Color.Secondary">Manage club members</MudText>
                            </MudStack>
                            <MudSpacer />
                            <MudIcon Icon="@Icons.Material.Filled.ChevronRight" Color="Color.Secondary" />
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudCard Class="smash-card smash-card-clickable" Elevation="2" @onclick="ViewSessions">
                    <MudCardContent>
                        <MudStack Row="true" Spacing="3" AlignItems="AlignItems.Center">
                            <MudAvatar Size="Size.Large" Color="Color.Secondary" Variant="Variant.Filled">
                                <MudIcon Icon="@Icons.Material.Filled.CalendarMonth" />
                            </MudAvatar>
                            <MudStack Spacing="0">
                                <MudText Typo="Typo.h6" Style="font-weight: 600;">Sessions</MudText>
                                <MudText Typo="Typo.body2" Color="Color.Secondary">View and create sessions</MudText>
                            </MudStack>
                            <MudSpacer />
                            <MudIcon Icon="@Icons.Material.Filled.ChevronRight" Color="Color.Secondary" />
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        </MudGrid>

        <MudPaper Class="pa-4" Elevation="1" Style="border-radius: var(--radius-lg);">
            <MudText Typo="Typo.subtitle2" Color="Color.Secondary" Class="mb-2">Club Details</MudText>
            <MudStack Row="true" Spacing="4">
                <MudStack Spacing="0">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Created</MudText>
                    <MudText Typo="Typo.body1">@_club.CreatedAt.ToShortDateString()</MudText>
                </MudStack>
                <MudStack Spacing="0">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Game Type</MudText>
                    <MudText Typo="Typo.body1">@_club.GameType</MudText>
                </MudStack>
            </MudStack>
        </MudPaper>
    </MudStack>
}

@code {
    [Parameter] public Guid ClubId { get; set; }
    private Club? _club;

    protected override async Task OnInitializedAsync()
    {
        _club = await ClubService.GetByIdAsync(ClubId);
    }

    private void ViewPlayers()
    {
        Navigation.NavigateTo($"/clubs/{ClubId}/players");
    }

    private void ViewSessions()
    {
        Navigation.NavigateTo($"/clubs/{ClubId}/sessions");
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/clubs");
    }

    private async Task OpenEditDialog()
    {
        var parameters = new DialogParameters<ClubEditorDialog>
        {
            { x => x.Club, _club }
        };

        var options = new DialogOptions
        {
            MaxWidth = MaxWidth.Small,
            FullWidth = true,
            CloseOnEscapeKey = true
        };

        var dialog = await DialogService.ShowAsync<ClubEditorDialog>("Edit Club", parameters, options);
        var result = await dialog.Result;

        if (result is { Canceled: false })
        {
            _club = await ClubService.GetByIdAsync(ClubId);
        }
    }
}
