@page "/clubs"
@using MudBlazor
@using SmashScheduler.Domain.Enums
@using SmashScheduler.Web.Components
@inherits FluxorComponent
@inject IState<ClubState> ClubState
@inject IDispatcher Dispatcher
@inject IDialogService DialogService
@inject NavigationManager Navigation

<PageTitle>Clubs</PageTitle>

<div class="page-header">
    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
        <MudStack>
            <MudText Typo="Typo.h4" Class="page-title">Your Clubs</MudText>
            <MudText Typo="Typo.body2" Class="page-subtitle">Manage your badminton clubs and sessions</MudText>
        </MudStack>
    </MudStack>
</div>

@if (ClubState.Value.IsLoading)
{
    <MudStack AlignItems="AlignItems.Center" Class="py-8">
        <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
    </MudStack>
}
else if (!string.IsNullOrEmpty(ClubState.Value.ErrorMessage))
{
    <MudAlert Severity="Severity.Error" Class="mb-4">
        @ClubState.Value.ErrorMessage
    </MudAlert>
}
else if (!ClubState.Value.Clubs.Any())
{
    <div class="empty-state">
        <MudIcon Icon="@Icons.Material.Filled.SportsHandball" Class="empty-icon" />
        <MudText Typo="Typo.h5" Class="empty-title">No clubs yet</MudText>
        <MudText Typo="Typo.body1" Class="empty-description">
            Create your first club to start organising badminton sessions
        </MudText>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   Size="Size.Large"
                   StartIcon="@Icons.Material.Filled.Add"
                   OnClick="OpenCreateDialog">
            Create Club
        </MudButton>
    </div>
}
else
{
    <MudGrid Spacing="3">
        @foreach (var club in ClubState.Value.Clubs)
        {
            <MudItem xs="12" sm="6" md="4">
                <MudCard Class="smash-card smash-card-clickable" Elevation="2" @onclick="() => NavigateToClub(club.Id)">
                    <MudCardContent>
                        <MudStack Row="true" Spacing="3" AlignItems="AlignItems.Start">
                            <div class="club-card-icon">
                                <MudIcon Icon="@Icons.Material.Filled.SportsTennis" />
                            </div>
                            <MudStack Spacing="1">
                                <MudText Typo="Typo.h6" Style="font-weight: 600;">@club.Name</MudText>
                                <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
                                    <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined" Color="Color.Primary">
                                        @club.DefaultCourtCount courts
                                    </MudChip>
                                    <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined" Color="Color.Secondary">
                                        @club.GameType
                                    </MudChip>
                                </MudStack>
                            </MudStack>
                        </MudStack>
                    </MudCardContent>
                    <MudCardActions Class="pa-4 pt-0">
                        <MudButton Variant="Variant.Text"
                                   Color="Color.Primary"
                                   EndIcon="@Icons.Material.Filled.ChevronRight"
                                   FullWidth="true"
                                   OnClick="() => NavigateToClub(club.Id)">
                            View Club
                        </MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        }
    </MudGrid>

    <MudFab Class="smash-fab smash-fab-fixed"
            StartIcon="@Icons.Material.Filled.Add"
            Label="Add Club"
            Size="Size.Large"
            OnClick="OpenCreateDialog" />
}

@code {
    protected override void OnInitialized()
    {
        base.OnInitialized();
        Dispatcher.Dispatch(new LoadClubsAction());
    }

    private void NavigateToClub(Guid clubId)
    {
        Dispatcher.Dispatch(new SelectClubAction(clubId));
        Navigation.NavigateTo($"/clubs/{clubId}");
    }

    private async Task OpenCreateDialog()
    {
        var options = new DialogOptions
        {
            MaxWidth = MaxWidth.Small,
            FullWidth = true,
            CloseOnEscapeKey = true
        };

        var dialog = await DialogService.ShowAsync<ClubEditorDialog>("Create Club", options);
        var result = await dialog.Result;

        if (result is { Canceled: false })
        {
            Dispatcher.Dispatch(new LoadClubsAction());
        }
    }
}
