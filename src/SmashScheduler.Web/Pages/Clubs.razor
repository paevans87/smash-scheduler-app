@page "/clubs"
@using SmashScheduler.Domain.Enums
@inherits FluxorComponent
@inject IState<ClubState> ClubState
@inject IDispatcher Dispatcher
@inject NavigationManager Navigation

<PageTitle>Clubs</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Clubs</MudText>

@if (ClubState.Value.IsLoading)
{
    <MudProgressCircular Indeterminate="true" />
}
else
{
    <MudGrid>
        @foreach (var club in ClubState.Value.Clubs)
        {
            <MudItem xs="12" sm="6" md="4">
                <MudCard Style="cursor:pointer" @onclick="() => NavigateToClub(club.Id)">
                    <MudCardContent>
                        <MudText Typo="Typo.h5">@club.Name</MudText>
                        <MudText Typo="Typo.body2">Courts: @club.DefaultCourtCount</MudText>
                        <MudText Typo="Typo.body2">Type: @club.GameType</MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        }
    </MudGrid>

    @if (!ClubState.Value.Clubs.Any())
    {
        <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mt-4">No clubs found. Create one to get started.</MudText>
    }

    <MudFab Color="Color.Primary"
            StartIcon="@Icons.Material.Filled.Add"
            Label="Add Club"
            OnClick="CreateTestClub"
            Style="position: fixed; bottom: 16px; right: 16px;" />
}

@code {
    protected override void OnInitialized()
    {
        base.OnInitialized();
        Dispatcher.Dispatch(new LoadClubsAction());
    }

    private void NavigateToClub(Guid clubId)
    {
        Dispatcher.Dispatch(new SelectClubAction(clubId));
        Navigation.NavigateTo($"/clubs/{clubId}");
    }

    private void CreateTestClub()
    {
        var count = ClubState.Value.Clubs.Count() + 1;
        Dispatcher.Dispatch(new CreateClubAction($"Test Club {count}", 4, GameType.Doubles));
    }
}
