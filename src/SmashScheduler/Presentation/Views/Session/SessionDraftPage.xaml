<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SmashScheduler.Presentation.ViewModels.Session"
             xmlns:controls="clr-namespace:SmashScheduler.Presentation.Controls"
             x:Class="SmashScheduler.Presentation.Views.Session.SessionDraftPage"
             x:DataType="viewmodels:SessionDraftViewModel"
             Title="Session Draft">

    <Grid RowDefinitions="Auto,*,Auto">

        <Frame Grid.Row="0"
              BackgroundColor="#F39C12"
              Padding="16"
              CornerRadius="0"
              HasShadow="False">

            <Grid ColumnDefinitions="Auto,*">
                <Label Grid.Column="0"
                      Text="⚠️ Draft"
                      TextColor="White"
                      FontSize="17"
                      FontAttributes="Bold" />

                <Label Grid.Column="1"
                      Text="{Binding SelectedPlayers.Count, StringFormat='{0} players selected'}"
                      TextColor="White"
                      FontSize="15"
                      HorizontalOptions="End"
                      VerticalOptions="Center" />
            </Grid>
        </Frame>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16" Spacing="16">

                <Label Text="Attending Players"
                      TextColor="#2C3E50"
                      FontSize="20"
                      FontAttributes="Bold" />

                <CollectionView ItemsSource="{Binding SelectedPlayers}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <SwipeView>
                                <SwipeView.LeftItems>
                                    <SwipeItems Mode="Execute">
                                        <SwipeItem Text="Remove"
                                                  BackgroundColor="#E74C3C"
                                                  Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SessionDraftViewModel}}, Path=RemovePlayerCommand}"
                                                  CommandParameter="{Binding .}" />
                                    </SwipeItems>
                                </SwipeView.LeftItems>

                                <controls:PlayerCard />
                            </SwipeView>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                    <CollectionView.EmptyView>
                        <Label Text="No players added yet"
                              TextColor="#7F8C8D"
                              FontSize="15"
                              Margin="16" />
                    </CollectionView.EmptyView>
                </CollectionView>

                <BoxView Color="#E8ECEF"
                        HeightRequest="1"
                        Margin="0,8" />

                <Label Text="Available Players"
                      TextColor="#2C3E50"
                      FontSize="20"
                      FontAttributes="Bold" />

                <CollectionView ItemsSource="{Binding AvailablePlayers}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <controls:PlayerCard>
                                <controls:PlayerCard.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SessionDraftViewModel}}, Path=AddPlayerCommand}"
                                                         CommandParameter="{Binding .}" />
                                </controls:PlayerCard.GestureRecognizers>
                            </controls:PlayerCard>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                    <CollectionView.EmptyView>
                        <Label Text="All club players added"
                              TextColor="#7F8C8D"
                              FontSize="15"
                              Margin="16" />
                    </CollectionView.EmptyView>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <VerticalStackLayout Grid.Row="2" Padding="16" Spacing="8">
            <Label Text="{Binding ErrorMessage}"
                  TextColor="#E74C3C"
                  FontSize="15"
                  IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}" />

            <Button Text="Start Session"
                   Command="{Binding StartSessionCommand}"
                   IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                   BackgroundColor="#27AE60"
                   TextColor="White"
                   CornerRadius="12"
                   Padding="16"
                   FontSize="17"
                   FontAttributes="Bold" />

            <Button Text="Cancel"
                   Command="{Binding CancelCommand}"
                   BackgroundColor="Transparent"
                   BorderColor="#7F8C8D"
                   BorderWidth="2"
                   TextColor="#7F8C8D"
                   CornerRadius="12"
                   Padding="16"
                   FontSize="17" />
        </VerticalStackLayout>
    </Grid>
</ContentPage>
